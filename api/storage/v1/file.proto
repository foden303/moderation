syntax = "proto3";

package storage.v1;

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "api/common/v1/pagination.proto";

option go_package = "storage/api/storage/v1;v1";
option java_multiple_files = true;
option java_package = "dev.kratos.api.storage.v1";
option java_outer_classname = "StorageProtoV1";

message File {
  string id = 1;
  optional string folder_id = 2;
  string owner_id = 3;
  string name = 4;
  string type = 5; // file | folder
  string space = 6; // normal | privacy
  optional string file_hash = 7;
  optional int64 file_size = 8;
  optional string file_type = 9; // image | video | document | audio | compressed | other
  optional string file_ext = 10;
  optional string file_mime_type = 11;
  optional string file_video_resolution = 12;
  optional google.protobuf.Timestamp recent_accessed_at = 13;
  int64 platform = 14;
  bool shared = 15;
  bool favorite = 16;
  optional google.protobuf.Timestamp deleted_at = 17;
  optional string deleted_by = 18;
  google.protobuf.Timestamp created_at = 19;
  google.protobuf.Timestamp updated_at = 20;
}
// The file service definition.
service File {
  // Create a new file
  rpc CreateFile(CreateFileRequest) returns (CreateFileResponse) {
    option (google.api.http) = {
      post: "/v1/files"
      body: "*"
    };
  }
  // Get file by ID
  rpc GetFile(GetFileRequest) returns (GetFileResponse) {
    option (google.api.http) = {
      get: "/v1/files/{id}"
    };
  }
  // Get files by IDs
  rpc GetFilesByIDs(GetFilesByIDsRequest) returns (GetFilesByIDsResponse) {
    option (google.api.http) = {
      post: "/v1/files/batch"
      body: "*"
    };
  }
  // List files in folder (with cursor pagination)
  rpc ListFiles(ListFilesRequest) returns (ListFilesResponse) {
    option (google.api.http) = {
      get: "/v1/files"
    };
  }
  // Get file by hash (for deduplication)
  rpc GetFileByHash(GetFileByHashRequest) returns (GetFileByHashResponse) {
    option (google.api.http) = {
      get: "/v1/files/hash/{file_hash}"
    };
  }
  // Move files to folder
  rpc MoveFiles(MoveFilesRequest) returns (MoveFilesResponse) {
    option (google.api.http) = {
      post: "/v1/files/move"
      body: "*"
    };
  }
  // Rename file
  rpc RenameFile(RenameFileRequest) returns (RenameFileResponse) {
    option (google.api.http) = {
      patch: "/v1/files/{id}/rename"
      body: "*"
    };
  }
  // Update favorite status
  rpc UpdateFavorite(UpdateFavoriteRequest) returns (UpdateFavoriteResponse) {
    option (google.api.http) = {
      patch: "/v1/files/favorite"
      body: "*"
    };
  }
  // Update recent accessed time
  rpc UpdateRecentAccess(UpdateRecentAccessRequest) returns (UpdateRecentAccessResponse) {
    option (google.api.http) = {
      patch: "/v1/files/recent"
      body: "*"
    };
  }
  // Move files to trash (soft delete)
  rpc TrashFiles(TrashFilesRequest) returns (TrashFilesResponse) {
    option (google.api.http) = {
      post: "/v1/files/trash"
      body: "*"
    };
  }
  // List files in trash
  rpc ListTrash(ListTrashRequest) returns (ListTrashResponse) {
    option (google.api.http) = {
      get: "/v1/trash"
    };
  }
  // Restore files from trash
  rpc RestoreFiles(RestoreFilesRequest) returns (RestoreFilesResponse) {
    option (google.api.http) = {
      post: "/v1/trash/restore"
      body: "*"
    };
  }
  // Delete files permanently
  rpc DeleteFilesPermanently(DeleteFilesPermanentlyRequest) returns (DeleteFilesPermanentlyResponse) {
    option (google.api.http) = {
      post: "/v1/trash/delete"
      body: "*"
    };
  }
  // Empty trash
  rpc EmptyTrash(EmptyTrashRequest) returns (EmptyTrashResponse) {
    option (google.api.http) = {
      delete: "/v1/trash"
    };
  }
}

// CreateFile
message CreateFileRequest {
  optional string folder_id = 1;
  string name = 2;
  string type = 3; // file | folder
  string space = 4; // normal | privacy
  optional string file_hash = 5;
  optional int64 file_size = 6;
  optional string file_type = 7;
  optional string file_ext = 8;
  optional string file_mime_type = 9;
  optional string file_video_resolution = 10;
  int64 platform = 11;
}

message CreateFileResponse {
  File file = 1;
}

// GetFile
message GetFileRequest {
  string id = 1;
}

message GetFileResponse {
  File file = 1;
}

// GetFilesByIDs
message GetFilesByIDsRequest {
  repeated string ids = 1;
}

message GetFilesByIDsResponse {
  repeated File files = 1;
}

// ListFiles
message ListFilesRequest {
  optional string folder_id = 1;
  common.v1.CursorPaginationRequest pagination = 2;
}

message ListFilesResponse {
  repeated File files = 1;
  common.v1.CursorPaginationResponse pagination = 2;
}

// GetFileByHash
message GetFileByHashRequest {
  optional string folder_id = 1;
  string file_hash = 2;
}

message GetFileByHashResponse {
  File file = 1;
}

// MoveFiles
message MoveFilesRequest {
  repeated string ids = 1;
  optional string folder_id = 2; // null = root
}

message MoveFilesResponse {
  int32 moved_count = 1;
}

// RenameFile
message RenameFileRequest {
  string id = 1;
  string new_name = 2;
}

message RenameFileResponse {
  File file = 1;
}

// UpdateFavorite
message UpdateFavoriteRequest {
  repeated string ids = 1;
  bool favorite = 2;
}

message UpdateFavoriteResponse {
  int32 updated_count = 1;
}

// UpdateRecentAccess
message UpdateRecentAccessRequest {
  repeated string ids = 1;
}

message UpdateRecentAccessResponse {
  int32 updated_count = 1;
}

// TrashFiles
message TrashFilesRequest {
  repeated string ids = 1;
}

message TrashFilesResponse {
  int32 trashed_count = 1;
}

// ListTrash
message ListTrashRequest {
  // pagination: Pagination details
  common.v1.CursorPaginationRequest pagination = 1;
}

message ListTrashResponse {
  // files: List of files in trash
  repeated File files = 1;
  // pagination: Pagination details
  common.v1.CursorPaginationResponse pagination = 2;
}

// RestoreFiles
message RestoreFilesRequest {
  // ids: IDs of files to be restored from trash
  repeated string ids = 1;
  // restore_to_root: Whether to restore files to root if original folder is deleted
  bool restore_to_root = 2; // true = restore to root if original folder deleted
}

message RestoreFilesResponse {
  // restored_count: Number of files restored from trash
  int32 restored_count = 1;
}

// DeleteFilesPermanently
message DeleteFilesPermanentlyRequest {
  // ids: IDs of files to be permanently deleted
  repeated string ids = 1;
}

message DeleteFilesPermanentlyResponse {
  // deleted_count: Number of files permanently deleted
  int32 deleted_count = 1;
}

// EmptyTrash
message EmptyTrashRequest {}

message EmptyTrashResponse {
  // deleted_count: Number of files permanently deleted from trash
  int32 deleted_count = 1;
}
